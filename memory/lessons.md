# 经验教训

> 从开发和调试中积累的实践经验

## 向量搜索

### 学习: 混合搜索效果最佳
- **问题**: 纯向量搜索有时会错过精确关键词匹配
- **解决**: 结合 BM25 全文搜索 + 向量搜索
- **配置**: `query.hybrid.enabled = true`

### 学习: 批量嵌入显著加速索引
- **问题**: 单条嵌入 API 调用慢
- **解决**: 使用 OpenAI Batch API (异步)
- **结果**: 大型代码库索引速度提升 10x

## TypeScript 开发

### 学习: 避免 `any` 的代价
- **问题**: 过度使用 `any` 导致运行时错误
- **解决**: 启用严格类型检查，使用类型守卫
- **工具**: `oxlint --typescript`

### 学习: 文件大小控制
- **经验**: 超过 700 LOC 的文件难以维护
- **做法**: 主动拆分，提取助手函数
- **收益**: 代码可读性和可测试性提升

## IM 渠道集成

### 学习: 考虑所有渠道
- **陷阱**: 只为 Telegram 优化，忽略了 Discord
- **原则**: 修改共享逻辑时，考虑所有内置+扩展渠道
- **检查清单**:
  - src/telegram, src/discord, src/slack, src/signal, src/imessage, src/web
  - extensions/*

---

## 模板

```markdown
### 学习: [标题]
- **问题**: [遇到的问题]
- **解决**: [如何解决]
- **经验**: [总结的经验]
```
